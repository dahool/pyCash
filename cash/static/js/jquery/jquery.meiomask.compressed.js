/**
 * jquery.meiomask.js
 * @version 1.0.2
 * The MIT License
 * Copyright (c) 2008 Fabio M. Costa http://www.meiocodigo.com
 */
(function(A){A.extend({mask:{rules:{"z":/[a-z]/,"Z":/[A-Z]/,"a":/[a-zA-Z]/,"*":/[0-9a-zA-Z]/,"@":/[0-9a-zA-ZçÇáàãéèíìóòõúùü]/},fixedChars:"[(),.:/ -]",keys:{BKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PGUP:33,PGDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,METAKEY:91,F5:116},options:{attr:"alt",mask:null,type:"fixed",defaultValue:"",onInvalid:function(){},onValid:function(){},onOverflow:function(){}},masks:{"phone":{mask:"(99) 9999-9999"},"phone-us":{mask:"(999) 9999-9999"},"cpf":{mask:"999.999.999-99"},"cnpj":{mask:"99.999.999/9999-99"},"date":{mask:"39/19/9999"},"date-us":{mask:"19/39/9999"},"cep":{mask:"99999-999"},"time":{mask:"29:69"},"cc":{mask:"9999 9999 9999 9999"},"integer":{mask:"999.999.999.999",type:"reverse"},"decimal":{mask:"99,999.999.999.999",type:"reverse",defaultValue:"000"},"decimal-us":{mask:"99.999,999,999,999",type:"reverse",defaultValue:"000"}},MAXLENGTH:{ie:2147483647},init:function(){if(!this.hasInit){var B;this.ignore=false;this.fixedCharsReg=new RegExp(this.fixedChars);this.fixedCharsRegG=new RegExp(this.fixedChars,"g");this.ignoreArray=new Array();for(B=0;B<=9;B++){this.rules[B]=new RegExp("[0-"+B+"]")}for(B in this.keys){this.ignoreArray.push(this.keys[B])}this.hasInit=true}},set:function(F,C){var B=this,D=A(F),E="maxlength";this.init();return D.each(function(){var L=A(this),M=A.extend({},B.options),K=L.attr(M.attr),G="",I=(A.browser.opera||(A.browser.mozilla&&parseFloat(A.browser.version.substr(0,3))<1.9))?"input":"paste";G=(typeof C=="string")?C:(K!="")?K:null;if(G){M.mask=G}if(B.masks[G]){M=A.extend(M,B.masks[G])}if(typeof C=="object"){M=A.extend(M,C)}if(A.metadata){M=A.extend(M,L.metadata())}if(M.mask!=null){B.unset(L);var H=M.defaultValue,J=L.attr(E);M=A.extend({},M,{maxlength:J,maskArray:M.mask.split(""),maskNonFixedCharsArray:M.mask.replace(B.fixedCharsRegG,"").split(""),defaultValue:M.defaultValue.split("")});L.data("mask",M);if(L.val()!=""){L.val(B.string(L.val(),M))}else{if(H!=""){L.val(B.string(H,M))}}if(M.type=="reverse"){L.css("text-align","right")}switch(true){case (A.browser.msie):L.attr(E,B.MAXLENGTH.ie);break;case (A.browser.safari):L.removeAttr(E);break;default:if(J>-1){L.removeAttr(E)}break}L.bind("keydown",{func:B._keyDown,thisObj:B},B._onMask).bind("keyup",{func:B._keyUp,thisObj:B},B._onMask).bind("keypress",{func:B._keyPress,thisObj:B},B._onMask).bind(I,{func:B._paste,thisObj:B},B._delayedOnMask)}})},unset:function(C){var B=A(C),D=this;return B.each(function(){var G=A(this);if(G.data("mask")){var E=G.data("mask").maxlength,F=(A.browser.opera||(A.browser.mozilla&&parseFloat(A.browser.version.substr(0,3))<1.9))?"input":"paste";if(E==-1){G.removeAttr("maxlength")}else{G.attr("maxlength",E)}G.unbind("keydown",D._onMask).unbind("keypress",D._onMask).unbind("keyup",D._onMask).unbind(F,D._delayedOnMask).removeData("mask")}})},string:function(D,B){this.init();var C={};if(typeof D!="string"){D=String(D)}if(typeof B=="string"){if(this.masks[B]){C=A.extend(C,this.masks[B])}else{C.mask=B}}else{if(typeof B=="object"){C=A.extend(C,B)}}return this.__maskArray(D.split(""),C.mask.replace(this.fixedCharsRegG,"").split(""),C.mask.split(""),(C.type=="reverse"),C.defaultValue)},_onMask:function(B){var D=B.data.thisObj,C={};C._this=B.target;C.$this=A(C._this);if(C.$this.attr("readonly")){return true}C.value=C.$this.val();C.valueArray=C.value.split("");C.data=C.$this.data("mask");C.nKey=D.__getKeyNumber(B);C.range=D.__getRangePosition(C._this);C.reverse=(C.data.type=="reverse");return B.data.func.call(D,B,C)},_delayedOnMask:function(B){setTimeout(function(){B.data.thisObj._onMask(B)},1)},_keyDown:function(B,C){this.ignore=(A.inArray(C.nKey,this.ignoreArray)>-1);return true},_keyUp:function(B,C){return this._paste(B,C)},_paste:function(C,D){var B=this.__maskArray(D.valueArray,D.data.maskNonFixedCharsArray,D.data.maskArray,D.reverse,D.data.defaultValue);D.$this.val(B);if(!D.reverse){this.__setRange(D._this,D.range.start,D.range.end)}return true},_keyPress:function(I,B){if(this.ignore||I.ctrlKey||I.metaKey||I.altKey){B.data.onValid.call(B._this,"");return true}var L=B.range.start,F=B.value,J=String.fromCharCode(B.nKey),E=F.substr(0,L),H=F.substr(B.range.end,F.length),D=B.data.maskArray;if(B.reverse){F=(E+J+H)}var K=F.replace(this.fixedCharsRegG,"").split(""),C=this.__extraPositionsTill(L,D);B.rsEp=L+C;if(!this.rules[D[B.rsEp]]){B.data.onOverflow.call(B._this,J);return false}else{if(!this.rules[D[B.rsEp]].test(J)){B.data.onInvalid.call(B._this,J);return false}else{B.data.onValid.call(B._this,J)}}var G=this.__maskArray(K,B.data.maskNonFixedCharsArray,D,B.reverse,B.data.defaultValue,C);B.$this.val(G);if(B.reverse){return this._keyPressReverse(I,B)}else{return this._keyPressFixed(I,B)}},_keyPressReverse:function(B,C){return false},_keyPressFixed:function(B,C){if(C.rangeStart==C.range.end||C.data.defaultValue){if((C.rsEp==0&&C.value.length==0)||C.rsEp<C.value.length){this.__setRange(C._this,C.rsEp,C.rsEp+1)}}else{this.__setRange(C._this,C.range.start,C.range.end)}return true},__getKeyNumber:function(B){return(B.charCode||B.keyCode||B.which)},__maskArray:function(G,F,D,C,B,E){if(C){G.reverse()}G=this.__removeInvalidChars(G,F);if(B){G=this.__applyDefaultValue.call(G,B)}G=this.__applyMask(G,D,E);if(C){G.reverse();return G.join("").substring(G.length-D.length)}else{return G.join("").substring(0,D.length)}},__applyDefaultValue:function(D){var B=D.length,C=this.length,E;for(E=C-1;E>=0;E--){if(this[E]==D[0]){this.pop()}else{break}}for(E=0;E<B;E++){if(!this[E]){this[E]=D[E]}}return this},__removeInvalidChars:function(D,C){for(var B=0;B<D.length;B++){if(C[B]&&this.rules[C[B]]&&!this.rules[C[B]].test(D[B])){D.splice(B,1);B--}}return D},__applyMask:function(D,B,E){if(typeof E=="undefined"){E=0}for(var C=0;C<D.length+E;C++){if(B[C]&&this.fixedCharsReg.test(B[C])){D.splice(C,0,B[C])}}return D},__extraPositionsTill:function(D,B){var C=0;while(this.fixedCharsReg.test(B[D])){D++;C++}return C},__setRange:function(D,E,B){if(typeof B=="undefined"){B=E}if(D.setSelectionRange){D.setSelectionRange(E,B)}else{var C=D.createTextRange();C.collapse();C.moveStart("character",E);C.moveEnd("character",B-E);C.select()}},__getRangePosition:function(E){var B={start:0,end:0};if(E.setSelectionRange){B.start=E.selectionStart;B.end=E.selectionEnd}else{if(document.selection&&document.selection.createRange){var D=document.selection.createRange();var C=D.duplicate();B.start=0-C.moveStart("character",-100000);B.end=B.start+D.text.length}}return B}}});A.fn.extend({setMask:function(B){return A.mask.set(this,B)},unsetMask:function(){return A.mask.unset(this)}})})(jQuery)